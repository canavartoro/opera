CREATE FUNCTION Barset.MikrobarKey
(
	@KEYFIELD VARCHAR(15)--= N'J00000000000003'
)
RETURNS INTEGER
AS BEGIN
DECLARE @LOOP INTEGER = 0, @NEWKEY INTEGER = 0
WHILE (@LOOP < LEN(@KEYFIELD)) BEGIN
	--PRINT SUBSTRING(@KEYFIELD, @LOOP + 1, 1) + N'<->' + CONVERT(NVARCHAR, ASCII(SUBSTRING(@KEYFIELD, @LOOP + 1, 1)))
	SET @NEWKEY = @NEWKEY + ASCII(SUBSTRING(@KEYFIELD, @LOOP + 1, 1))
	SET @LOOP = @LOOP + 1
END
RETURN ISNULL(@NEWKEY, -1)
END
